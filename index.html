<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Agismint ‚Äî User-owned, serverless, self-audited</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  :root{--bg:#0b0d12;--card:#131722;--text:#eef2f8;--accent:#22e1b8;--accent2:#8e7cff;--danger:#ff6b6b;--ok:#8ef8d0;--warn:#ffd66b}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial}
  header,footer{padding:16px 20px;border-bottom:1px solid #222636} footer{border-top:1px solid #222636}
  nav{display:flex;gap:8px;flex-wrap:wrap;padding:12px 20px;border-bottom:1px solid #222636}
  nav button{background:#1a1f2c;color:var(--text);border:1px solid #2a3042;padding:10px 12px;border-radius:12px;cursor:pointer}
  .container{padding:16px 20px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:14px}
  .card{background:var(--card);border:1px solid #24293a;border-radius:16px;padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  input,select{background:#1a1f2c;color:var(--text);border:1px solid #2a3042;border-radius:10px;padding:9px;min-width:160px}
  .btn{background:var(--accent);color:#041e17;border:none;border-radius:10px;padding:9px 12px;cursor:pointer;font-weight:600}
  .btn2{background:#26314b;color:var(--text);border:1px solid #3b4663;border-radius:10px;padding:9px 12px;cursor:pointer}
  .mini{font-size:12px;opacity:.9;margin-top:6px}
  .stat{display:flex;justify-content:space-between;margin:6px 0}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{border-bottom:1px solid #2a3042;padding:6px;text-align:left}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--danger)}
</style>
</head>
<body>
<header>
  <div>
    <div style="font-weight:700">‚ôæÔ∏èüíé Agismint</div>
    <div class="mini">User-owned ‚Ä¢ Serverless ‚Ä¢ Self-audited</div>
  </div>
  <div class="mini">Founder: <span id="founderBalance">0.00</span> | Profit: <span id="platformProfit">0.00</span> | Integrity: <span id="integrityFlag" class="ok">OK</span></div>
</header>

<nav id="nav">
  <button data-tab="wallets" class="active">Wallets</button>
  <button data-tab="buy">Buy AGIS</button>
  <button data-tab="gaming">Locked‚ÄëLoss</button>
  <button data-tab="market">Marketplace</button>
  <button data-tab="missions">Missions</button>
  <button data-tab="stats">Stats</button>
  <button data-tab="settings">Settings</button>
</nav>

<div class="container">
  <section id="tab-wallets" class="grid">
    <div class="card">
      <h3>Create account</h3>
      <div class="row">
        <input id="username" placeholder="Username"/>
        <input id="birthdate" type="date"/>
        <select id="country"><option value="AU">Australia</option><option value="US">USA</option><option value="UK">UK</option></select>
        <button class="btn" id="btnCreate">Create</button>
      </div>
      <div id="walletsList" class="mini">No account yet.</div>
      <div id="walletsErr" class="mini bad"></div>
      <div class="mini">Under-18 accounts use age-locked NFTs and guardian controls.</div>
    </div>
    <div class="card">
      <h3>Add chain</h3>
      <div class="row">
        <select id="chainAdd"><option>Ethereum</option><option>BSC</option><option>Solana</option></select>
        <button class="btn2" id="btnAddChain">Add</button>
      </div>
      <div id="chainMsg" class="mini"></div>
    </div>
    <div class="card">
      <h3>Withdraw</h3>
      <div class="row">
        <select id="withdrawMethod"><option>PayID</option><option>PayPal</option><option>Direct Debit</option><option>MetaMask</option><option>Coinbase</option></select>
        <input id="withdrawAmount" type="number" step="0.01" placeholder="Amount"/>
        <button class="btn" id="btnWithdraw">Withdraw</button>
      </div>
      <div id="withdrawMsg" class="mini"></div>
      <div id="withdrawErr" class="mini bad"></div>
    </div>
  </section>

  <section id="tab-buy" class="grid" style="display:none">
    <div class="card">
      <h3>Buy AGISCrypto</h3>
      <div class="row">
        <input id="buyAmount" type="number" step="0.01" placeholder="Amount (AGIS)"/>
        <select id="buyMethod"><option>Card</option><option>PayID</option><option>PayPal</option><option>MetaMask</option><option>Coinbase</option></select>
        <button class="btn" id="btnBuy">Buy</button>
      </div>
      <div id="buyMsg" class="mini"></div>
      <div id="buyErr" class="mini bad"></div>
    </div>
    <div class="card">
      <h3>Autobots revenue</h3>
      <div class="row">
        <button class="btn2" id="toggleTrading">Trading: <span id="botTrading" class="pill">off</span></button>
        <button class="btn2" id="toggleRarity">Rarity: <span id="botRarity" class="pill">off</span></button>
        <button class="btn2" id="toggleRepair">Repair: <span id="botRepair" class="pill">off</span></button>
      </div>
      <div id="botLog" class="mini"></div>
    </div>
  </section>

  <section id="tab-gaming" class="grid" style="display:none">
    <div class="card">
      <h3>Play</h3>
      <div class="row">
        <input id="stakeAmount" type="number" step="0.01" placeholder="Stake"/>
        <button class="btn" id="btnSpin">Spin</button>
        <button class="btn2" id="btnClaim">Claim winnings</button>
      </div>
      <div id="gamingMsg" class="mini"></div>
      <div id="gamingErr" class="mini bad"></div>
      <div class="mini">Wins credit instantly; losses enter your vault, compounding daily for 90 days.</div>
    </div>
    <div class="card">
      <h3>Locked‚ÄëLoss vault</h3>
      <div class="stat"><span>Locked</span><span id="vaultLocked">0.00</span></div>
      <div class="stat"><span>Daily interest</span><span id="vaultInterest">1.00%</span></div>
      <div class="stat"><span>Unlock at</span><span id="vaultTimer">‚Äî</span></div>
      <div class="row">
        <button class="btn2" id="btnApplyInterest">Apply daily</button>
        <button class="btn2" id="btnUnlock">Unlock</button>
      </div>
      <div id="vaultErr" class="mini bad"></div>
    </div>
  </section>

  <section id="tab-market" class="grid" style="display:none">
    <div class="card">
      <h3>List item</h3>
      <div class="row">
        <input id="listTitle" placeholder="Title"/>
        <input id="listPrice" type="number" step="0.01" placeholder="Price"/>
        <button class="btn" id="btnList">List</button>
      </div>
      <div id="listErr" class="mini bad"></div>
      <div class="mini">Resales route protocol royalties to the founder and creators.</div>
    </div>
    <div class="card">
      <h3>Live listings</h3>
      <table id="marketTable"><thead><tr><th>Title</th><th>Price</th><th>Seller</th><th>Action</th></tr></thead><tbody></tbody></table>
      <div id="marketErr" class="mini bad"></div>
    </div>
    <div class="card">
      <h3>Rarity tracker</h3>
      <div class="stat"><span>Common</span><span id="rarCommon">0</span></div>
      <div class="stat"><span>Rare</span><span id="rarRare">0</span></div>
      <div class="stat"><span>Mystic</span><span id="rarMystic">0</span></div>
      <div class="stat"><span>Legendary</span><span id="rarLegendary">0</span></div>
      <button class="btn2" id="btnRefreshRarity">Refresh</button>
    </div>
  </section>

  <section id="tab-missions" class="grid" style="display:none">
    <div class="card">
      <h3>Daily missions</h3>
      <div class="row">
        <button class="btn2" id="btnLearn">Learn ‚Üí earn</button>
        <button class="btn2" id="btnPlayMission">Play ‚Üí earn</button>
        <button class="btn2" id="btnEarn">Tasks ‚Üí earn</button>
        <button class="btn2" id="btnMine">Mine ‚Üí drop</button>
      </div>
      <div id="missionsMsg" class="mini"></div>
      <div id="missionsErr" class="mini bad"></div>
      <div class="mini">Rate-limited to protect fairness and prevent abuse.</div>
    </div>
    <div class="card">
      <h3>Persona</h3>
      <div class="row">
        <select id="personaSelect"><option value="adult">Adult</option><option value="teen">Teen</option><option value="kid">Kid</option></select>
        <button class="btn2" id="btnPersona">Adapt UI</button>
      </div>
      <div id="personaMsg" class="mini">Persona guides content and restrictions.</div>
    </div>
  </section>

  <section id="tab-stats" class="grid" style="display:none">
    <div class="card">
      <h3>System health</h3>
      <div class="stat"><span>Status</span><span id="healthStatus">OK</span></div>
      <div class="stat"><span>Uptime</span><span id="healthUptime">live</span></div>
      <div class="stat"><span>Active wallets</span><span id="healthWallets">0</span></div>
      <div class="row"><button class="btn2" id="btnRefreshHealth">Refresh</button></div>
      <div class="mini">Self-monitoring, anomaly detection, and repair run continuously.</div>
    </div>
    <div class="card">
      <h3>Alerts</h3>
      <div id="alertList" style="max-height:220px;overflow:auto"></div>
      <button class="btn2" id="btnRefreshAlerts">Refresh alerts</button>
    </div>
    <div class="card">
      <h3>Transactions</h3>
      <table id="txTable"><thead><tr><th>Time</th><th>Wallet</th><th>Amount</th><th>Royalty</th></tr></thead><tbody></tbody></table>
      <button class="btn2" id="btnRefreshTx">Refresh</button>
    </div>
  </section>

  <section id="tab-settings" class="grid" style="display:none">
    <div class="card">
      <h3>Insurance & treasury</h3>
      <div class="stat"><span>Insurance pool</span><span id="insPool">0.00</span></div>
      <div class="stat"><span>Treasury</span><span id="treasury">0.00</span></div>
      <div class="row">
        <button class="btn2" id="btnPremium">Premium +</button>
        <button class="btn2" id="btnPayout">Payout ‚Üí treasury</button>
      </div>
      <div id="insErr" class="mini bad"></div>
    </div>
    <div class="card">
      <h3>Ownership</h3>
      <div class="mini">Export/import your profile JSON. You control and carry your data.</div>
      <div class="row">
        <button class="btn2" id="btnExport">Export profile</button>
        <input type="file" id="importFile" accept=".json"/>
        <button class="btn2" id="btnImport">Import</button>
      </div>
      <div id="importErr" class="mini bad"></div>
    </div>
    <div class="card">
      <h3>Integrity & self-test</h3>
      <div class="stat"><span>Last audit</span><span id="lastAudit">never</span></div>
      <div class="row">
        <button class="btn2" id="btnAudit">Run self-audit</button>
        <button class="btn2" id="btnSelfTest">Run self-test</button>
      </div>
      <div id="auditMsg" class="mini"></div>
      <div id="selfTestMsg" class="mini"></div>
    </div>
  </section>
</div>

<footer>¬© Agismint ‚Äî Infinite Trust. Infinite Growth.</footer>

<script>
const STATE = JSON.parse(localStorage.getItem("agismint_state")||"null") || {
  users: [], currentUserId: null,
  bots: {trading:false, rarity:false, repair:false},
  founderBalance: 0, platformProfit: 0,
  listings: [], alerts: [], tx: [],
  health: {status:"OK", uptime:"live", active_wallets:0},
  insurance: {pool:0, treasury:0}, integrity: {lastHash:"", lastAudit:""}
};
function save(){ localStorage.setItem("agismint_state", JSON.stringify(STATE)); }
function nowStr(){ return new Date().toLocaleString(); }
function fmt(n){ return Number(n).toFixed(2); }
function guardNumber(v,min=0.01){ const n=Number(v); return (!Number.isFinite(n)||n<min)?null:n; }
function findUser(){ return STATE.users.find(x=>x.id===STATE.currentUserId)||null; }

document.querySelectorAll('#nav button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('#nav button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const tab = btn.dataset.tab;
    document.querySelectorAll('.container section').forEach(s=>s.style.display='none');
    document.querySelector('#tab-'+tab).style.display='grid';
  });
});

function render(){
  const u=findUser();
  document.getElementById('founderBalance').textContent = fmt(STATE.founderBalance);
  document.getElementById('platformProfit').textContent = fmt(STATE.platformProfit);
  document.getElementById('walletsList').textContent = u? `Account: ${u.name} (${u.country}) ‚Ä¢ AGIS=${fmt(u.balances.AGIS)} ‚Ä¢ Chains=${u.chains.join(', ')||'none'}` : "No account yet.";
  document.getElementById('healthWallets').textContent = STATE.users.length;
  document.getElementById('healthStatus').textContent = STATE.health.status;
  document.getElementById('healthUptime').textContent = STATE.health.uptime;
  renderMarket(); renderRarity(); renderAlerts(); renderTx(); renderVault();
}
function renderMarket(){
  const tb = document.querySelector('#marketTable tbody'); tb.innerHTML="";
  STATE.listings.forEach((l,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${l.title}</td><td>${fmt(l.price)}</td><td>${l.seller}</td><td><button class="btn2" data-idx="${i}">Buy</button></td>`;
    tb.appendChild(tr);
  });
  tb.querySelectorAll('button[data-idx]').forEach(b=>b.addEventListener('click',()=>buyListing(Number(b.getAttribute('data-idx')))));
}
function renderRarity(){
  const n=STATE.listings.length;
  const common=Math.max(0,Math.floor(n*0.6)), rare=Math.max(0,Math.floor(n*0.25)), mystic=Math.max(0,Math.floor(n*0.12)), legendary=Math.max(0,n-(common+rare+mystic));
  document.getElementById('rarCommon').textContent=common; document.getElementById('rarRare').textContent=rare; document.getElementById('rarMystic').textContent=mystic; document.getElementById('rarLegendary').textContent=legendary;
}
function renderAlerts(){
  const list=document.getElementById('alertList'); list.innerHTML="";
  STATE.alerts.slice(-50).reverse().forEach(a=>{ const d=document.createElement('div'); d.textContent=`[${a.time}] ${a.msg}`; list.appendChild(d); });
}
function renderTx(){
  const tb=document.querySelector('#txTable tbody'); tb.innerHTML="";
  STATE.tx.slice(-50).reverse().forEach(t=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${t.timestamp}</td><td>${t.wallet}</td><td>${fmt(t.amount)}</td><td>${fmt(t.royalty)}</td>`; tb.appendChild(tr); });
}
function renderVault(){
  const u=findUser(); if(!u) return;
  document.getElementById('vaultLocked').textContent = fmt(u.vault.locked||0);
  document.getElementById('vaultInterest').textContent = ((u.vault.dailyInterest||0.01)*100).toFixed(2)+"%";
  document.getElementById('vaultTimer').textContent = u.vault.unlockTs? new Date(u.vault.unlockTs).toLocaleString() : "‚Äî";
}

document.getElementById('btnCreate').addEventListener('click', ()=>{
  document.getElementById('walletsErr').textContent="";
  const name=document.getElementById('username').value.trim();
  const birth=document.getElementById('birthdate').value;
  const country=document.getElementById('country').value;
  if(!name) return document.getElementById('walletsErr').textContent="Username required.";
  if(!birth) return document.getElementById('walletsErr').textContent="Birthdate required.";
  const age=Math.floor((Date.now()-new Date(birth).getTime())/(365.25*24*3600*1000));
  const kid=age<18; const id="uid_"+Math.random().toString(36).slice(2);
  STATE.users.push({id,name,birth,country,balances:{AGIS:0},chains:[],vault:{locked:0,dailyInterest:0.01,unlockTs:null,ageLockedNFT:kid}});
  STATE.currentUserId=id; STATE.alerts.push({time:nowStr(),msg:`User created: ${name}`}); save(); render();
});
document.getElementById('btnAddChain').addEventListener('click', ()=>{
  const u=findUser(); if(!u) return (document.getElementById('chainMsg').textContent="Create an account first.");
  const chain=document.getElementById('chainAdd').value;
  if(!u.chains.includes(chain)) u.chains.push(chain);
  STATE.alerts.push({time:nowStr(),msg:`Chain added: ${chain}`}); save(); render();
});
document.getElementById('btnWithdraw').addEventListener('click', ()=>{
  document.getElementById('withdrawErr').textContent=""; document.getElementById('withdrawMsg').textContent="";
  const u=findUser(); if(!u) return (document.getElementById('withdrawErr').textContent="Create an account first.");
  const amt=guardNumber(document.getElementById('withdrawAmount').value); if(!amt) return (document.getElementById('withdrawErr').textContent="Enter a valid amount.");
  if(u.balances.AGIS<amt) return (document.getElementById('withdrawErr').textContent="Insufficient balance.");
  const fee=+(amt*0.01).toFixed(2); u.balances.AGIS=+(u.balances.AGIS-amt).toFixed(2);
  STATE.platformProfit=+(STATE.platformProfit+fee).toFixed(2);
  STATE.tx.push({timestamp:nowStr(),wallet:u.name,amount:-amt,royalty:fee});
  document.getElementById('withdrawMsg').textContent=`Withdrawn ${fmt(amt)}.`; save(); render();
});
document.getElementById('btnBuy').addEventListener('click', ()=>{
  document.getElementById('buyErr').textContent=""; document.getElementById('buyMsg').textContent="";
  const u=findUser(); if(!u) return (document.getElementById('buyErr').textContent="Create an account first.");
  const amt=guardNumber(document.getElementById('buyAmount').value); if(!amt) return (document.getElementById('buyErr').textContent="Enter a valid amount.");
  const royalty=+(amt*0.005).toFixed(2); u.balances.AGIS=+(u.balances.AGIS+amt).toFixed(2);
  STATE.founderBalance=+(STATE.founderBalance+royalty).toFixed(2);
  STATE.tx.push({timestamp:nowStr(),wallet:u.name,amount:+amt,royalty});
  document.getElementById('buyMsg').textContent=`Purchased ${fmt(amt)} AGIS.`; save(); render();
});
document.getElementById('toggleTrading').addEventListener('click', ()=>{
  STATE.bots.trading=!STATE.bots.trading; document.getElementById('botTrading').textContent=STATE.bots.trading?'on':'off';
  document.getElementById('botLog').textContent=`Trading bot ${STATE.bots.trading?'enabled':'disabled'} ‚Ä¢ ${nowStr()}`; save();
});
document.getElementById('toggleRarity').addEventListener('click', ()=>{
  STATE.bots.rarity=!STATE.bots.rarity; document.getElementById('botRarity').textContent=STATE.bots.rarity?'on':'off';
  document.getElementById('botLog').textContent=`Rarity bot ${STATE.bots.rarity?'enabled':'disabled'} ‚Ä¢ ${nowStr()}`; save();
});
document.getElementById('toggleRepair').addEventListener('click', ()=>{
  STATE.bots.repair=!STATE.bots.repair; document.getElementById('botRepair').textContent=STATE.bots.repair?'on':'off';
  document.getElementById('botLog').textContent=`Repair bot ${STATE.bots.repair?'enabled':'disabled'} ‚Ä¢ ${nowStr()}`; save();
});
document.getElementById('btnSpin').addEventListener('click', ()=>{
  document.getElementById('gamingErr').textContent=""; document.getElementById('gamingMsg').textContent="";
  const u=findUser(); if(!u) return (document.getElementById('gamingErr').textContent="Create an account first.");
  const stake=guardNumber(document.getElementById('stakeAmount').value); if(!stake) return (document.getElementById('gamingErr').textContent="Enter a valid stake.");
  const win=Math.random()<0.48;
  if(win){
    const payout=+(stake*2).toFixed(2); u.balances.AGIS=+(u.balances.AGIS+payout).toFixed(2);
    const royalty=+(stake*0.02).toFixed(2); STATE.founderBalance=+(STATE.founderBalance+royalty).toFixed(2);
    STATE.tx.push({timestamp:nowStr(),wallet:u.name,amount:+payout,royalty});
    STATE.alerts.push({time:nowStr(),msg:`Win: +${fmt(payout)} for ${u.name}`});
    document.getElementById('gamingMsg').textContent=`Win! ${fmt(payout)} credited.`;
  } else {
    u.vault.locked=+(u.vault.locked+stake).toFixed(2);
    if(!u.vault.unlockTs) u.vault.unlockTs=Date.now()+90*24*3600*1000;
    STATE.alerts.push({time:nowStr(),msg:`Loss locked: +${fmt(stake)} for ${u.name}`});
    document.getElementById('gamingMsg').textContent=`Loss parked: ${fmt(stake)} locked ~90 days.`;
  }
  save(); render();
});
document.getElementById('btnClaim').addEventListener('click', ()=>{
  document.getElementById('gamingMsg').textContent="Winnings are in your balance. Use Withdraw.";
});
document.getElementById('btnApplyInterest').addEventListener('click', ()=>{
  const u=findUser(); if(!u) return (document.getElementById('vaultErr').textContent="Create an account first.");
  u.vault.locked=+(u.vault.locked*(1+u.vault.dailyInterest)).toFixed(2); save(); render();
});
document.getElementById('btnUnlock').addEventListener('click', ()=>{
  const u=findUser(); if(!u) return (document.getElementById('vaultErr').textContent="Create an account first.");
  if(!u.vault.unlockTs || Date.now()<u.vault.unlockTs) return (document.getElementById('vaultErr').textContent="Not ready yet.");
  const amt=u.vault.locked; u.balances.AGIS=+(u.balances.AGIS+amt).toFixed(2);
  STATE.tx.push({timestamp:nowStr(),wallet:u.name,amount:+amt,royalty:0});
  u.vault.locked=0; u.vault.unlockTs=null; save(); render();
});
document.getElementById('btnList').addEventListener('click', ()=>{
  document.getElementById('listErr').textContent="";
  const u=findUser(); if(!u) return (document.getElementById('listErr').textContent="Create an account first.");
  const title=document.getElementById('listTitle').value.trim(); const price=guardNumber(document.getElementById('listPrice').value);
  if(!title) return (document.getElementById('listErr').textContent="Title required."); if(!price) return (document.getElementById('listErr').textContent="Enter a valid price.");
  STATE.listings.push({title,price,seller:u.name}); STATE.alerts.push({time:nowStr(),msg:`Listed: ${title} @ ${fmt(price)}`}); save(); render();
});
function buyListing(i){
  const u=findUser(); if(!u) return (document.getElementById('marketErr').textContent="Create an account first.");
  const l=STATE.listings[i]; if(!l) return (document.getElementById('marketErr').textContent="Listing not found.");
  if(u.balances.AGIS<l.price) return (document.getElementById('marketErr').textContent="Insufficient AGIS.");
  const royalty=+(l.price*0.02).toFixed(2); u.balances.AGIS=+(u.balances.AGIS-l.price).toFixed(2);
  STATE.founderBalance=+(STATE.founderBalance+royalty).toFixed(2);
  STATE.tx.push({timestamp:nowStr(),wallet:u.name,amount:-l.price,royalty}); save(); render();
}
document.getElementById('btnRefreshRarity').addEventListener('click', renderRarity);
document.getElementById('btnLearn').addEventListener('click', ()=>mission(0.20,'Learned'));
document.getElementById('btnPlayMission').addEventListener('click', ()=>mission(0.15,'Played'));
document.getElementById('btnEarn').addEventListener('click', ()=>mission(0.25,'Task'));
document.getElementById('btnMine').addEventListener('click', ()=>mission(0.10,'Mined'));
function mission(amt,label){
  document.getElementById('missionsErr').textContent=""; document.getElementById('missionsMsg').textContent="";
  const u=findUser(); if(!u) return (document.getElementById('missionsErr').textContent="Create an account first.");
  const recent=STATE.tx.slice(-10).filter(t=>t.wallet===u.name && (Date.now()-new Date(t.timestamp).getTime())<60*1000);
  if(recent.length>=3) return (document.getElementById('missionsErr').textContent="Rate limit: try again soon.");
  u.balances.AGIS=+(u.balances.AGIS+amt).toFixed(2);
  STATE.tx.push({timestamp:nowStr(),wallet:u.name,amount:+amt,royalty:0});
  STATE.alerts.push({time:nowStr(),msg:`Mission: ${label} +${fmt(amt)}`});
  document.getElementById('missionsMsg').textContent=`${label}: +${fmt(amt)} AGIS`; save(); render();
}
document.getElementById('btnPersona').addEventListener('click', ()=>{
  document.getElementById('personaMsg').textContent = `Persona set: ${document.getElementById('personaSelect').value}`;
});
document.getElementById('btnRefreshHealth').addEventListener('click', render);
document.getElementById('btnRefreshAlerts').addEventListener('click', renderAlerts);
document.getElementById('btnRefreshTx').addEventListener('click', renderTx);
document.getElementById('btnPremium').addEventListener('click', ()=>{
  STATE.insurance.pool=+(STATE.insurance.pool+5).toFixed(2);
  document.getElementById('insPool').textContent=fmt(STATE.insurance.pool); save();
});
document.getElementById('btnPayout').addEventListener('click', ()=>{
  if(STATE.insurance.pool<3) return (document.getElementById('insErr').textContent="Pool too low.");
  STATE.insurance.pool=+(STATE.insurance.pool-3).toFixed(2);
  STATE.insurance.treasury=+(STATE.insurance.treasury+3).toFixed(2);
  document.getElementById('insPool').textContent=fmt(STATE.insurance.pool);
  document.getElementById('treasury').textContent=fmt(STATE.insurance.treasury); save();
});
document.getElementById('btnExport').addEventListener('click', ()=>{
  const blob=new Blob([JSON.stringify(STATE,null,2)],{type:"application/json"});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="agismint_profile.json"; a.click();
});
document.getElementById('btnImport').addEventListener('click', ()=>{
  document.getElementById('importErr').textContent="";
  const f=document.getElementById('importFile').files[0]; if(!f) return (document.getElementById('importErr').textContent="Select a file.");
  const r=new FileReader(); r.onload=()=>{ try{
    const obj=JSON.parse(r.result); if(!obj||!Array.isArray(obj.users)) throw new Error("Bad JSON");
    Object.assign(STATE,obj); save(); render();
  }catch(e){ document.getElementById('importErr').textContent="Import failed: "+e.message; } }; r.readAsText(f);
});
document.getElementById('btnAudit').addEventListener('click', ()=>{
  const snap=JSON.stringify(STATE); const hash=(new TextEncoder().encode(snap).length).toString(16);
  STATE.integrity.lastHash=hash; STATE.integrity.lastAudit=nowStr();
  document.getElementById('lastAudit').textContent=STATE.integrity.lastAudit;
  document.getElementById('integrityFlag').textContent="OK"; document.getElementById('integrityFlag').className="ok"; save();
  document.getElementById('auditMsg').textContent = `Audit hash: ${hash}`;
});
document.getElementById('btnSelfTest').addEventListener('click', ()=>{
  let ok=true; const msgs=[];
  if(typeof STATE.founderBalance!=="number"){ ok=false; msgs.push("Founder balance invalid"); } else msgs.push("Founder OK");
  if(!Array.isArray(STATE.users)){ ok=false; msgs.push("Users invalid"); } else msgs.push("Users OK");
  if(!Array.isArray(STATE.tx)){ ok=false; msgs.push("Tx invalid"); } else msgs.push("Tx OK");
  document.getElementById('selfTestMsg').textContent=(ok?"Self-test passed: ":"Issues: ")+msgs.join(" ‚Ä¢ ");
  document.getElementById('integrityFlag').textContent=ok?"OK":"CHECK"; document.getElementById('integrityFlag').className=ok?"ok":"warn";
});
setInterval(()=>{ // live loop
  if(STATE.bots.trading){ STATE.platformProfit=+(STATE.platformProfit+0.05).toFixed(2); STATE.alerts.push({time:nowStr(),msg:"Trading cycle profit +0.05"}); save(); render(); }
  if(STATE.bots.rarity){ renderRarity(); STATE.alerts.push({time:nowStr(),msg:"Rarity refreshed"}); save(); }
  if(STATE.bots.repair){ STATE.health.status="OK"; STATE.health.uptime="live"; save(); render(); }
}, 3500);

render();
</script>
</body>
</html>